# MAIN CONCEPTS

## # Hello World

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <style type="text/css">
      #app {
        color: #61dafb;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>

    <!-- 
    <script crossorigin src="https://unpkg.com/react@16.12.0/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16.12.0/umd/react-dom.development.js"></script> 
    <script crossorigin src="https://unpkg.com/babel-standalone@7.0.0-beta.3/babel.min.js"></script>    
    -->
    <script src="https://cdn.jsdelivr.net/npm/react@16.12.0/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@16.12.0/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.8.4/babel.min.js"></script>
    <script type="text/babel">
      // 1. è™šæ‹Ÿ DOM å…ƒç´ å¯¹è±¡ï¼Œä¸æ˜¯å­—ç¬¦ä¸²ï¼›
      // é‡è¦ï¼šæ²¡æœ‰æŠ¥é”™çš„åŸå› åœ¨äºè¯¥è„šæœ¬ type ä¸º â€œtext/babelâ€ï¼Œ
      // "text/babel" å£°æ˜ï¼Œå‘ŠçŸ¥ babel.js è§£æé‡Œé¢çš„ä»£ç ï¼Œå‰æä½¿éœ€è¦å¼•å…¥ babel.js æ–‡ä»¶
      const vDom = <h1>Hello, world!</h1>
      // 2. å°† è™šæ‹Ÿ DOM å…ƒç´ å¯¹è±¡æ¸²æŸ“åˆ°é¡µé¢çœŸå® DOM å®¹å™¨ä¸­
      ReactDOM.render(vDom, document.querySelector("#app"))
    </script>
  </body>
</html>
```

## # Introducing JSX

```js
// The tag syntax is neither a string nor html
const element = <h1>Hello, world!</h1>
```

> JSX, that is a syntax extension to JavaScript.

JSX å¯ä»¥å¾ˆå¥½çš„æè¿° UI åº”è¯¥å‘ˆç°å‡ºå®ƒåº”æœ‰äº¤äº’çš„æœ¬è´¨å½¢å¼ã€‚

### # Why JSX

React è®¤ä¸ºæ¸²æŸ“é€»è¾‘æœ¬è´¨ä¸Šä¸å…¶ä»– UI é€»è¾‘å†…åœ¨è€¦åˆï¼Œæ¯”å¦‚ï¼Œåœ¨ UI ä¸­éœ€è¦ç»‘å®šå¤„ç†äº‹ä»¶ã€åœ¨æŸäº›æ—¶åˆ»çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶éœ€è¦é€šçŸ¥åˆ° UIï¼Œä»¥åŠéœ€è¦åœ¨ UI ä¸­å±•ç¤ºå‡†å¤‡å¥½çš„æ•°æ®ã€‚

### # Embedding Expressions in JSX

```javascript
const name = "Nicholas"
const element = <h1>Hello, {name}</h1>

ReactDOM.render(element, document.querySelector("#app"))
```

åœ¨ JSX è¯­æ³•ä¸­ï¼Œä½ å¯ä»¥åœ¨å¤§æ‹¬å·å†…æ”¾ç½®ä»»ä½•æœ‰æ•ˆçš„ JavaScript è¡¨è¾¾å¼ã€‚

```javascript
// åœ¨ JSX ä¸­åµŒå…¥è¡¨è¾¾å¼
function formatName(user) {
  return user.firstName + " " + user.lastName
}

const user = {
  firstName: "Nicholas",
  lastName: "Eee"
}

const vDomEle = <h1>Hello, {formatName(user)}</h1>

ReactDOM.render(vDomEle, document.querySelector("#app"))
```

### # JSX is an Expression Too

> After compilation, JSX expressions become regular JavaScript function calls and evaluate to JavaScript objects.

```javascript
// å¯ä»¥åœ¨ if è¯­å¥å’Œ for è¯­å¥å¾ªç¯çš„ä»£ç å—ä¸­ä½¿ç”¨ JSX
function getGreeting(user) {
  if (user) {
    return <h1>Hello, {formatName(user)}!</h1>
  } else {
    return <h1>Hello, Nicholas.</h1>
  }
}
```

### # Specifying Attributes with JSX

```javascript
// You can use quotes to specify string literals as attributes
const element = <div tabIndex="0"></div>
```

```javascript
// You may also use curly braces to embed a JavaScript expression in an attribute
const element = <img src={user.avatarUrl} />
```

> Donâ€™t put quotes around curly braces when embedding a JavaScript expression in an attribute. You should either use quotes (for string values) or curly braces (for expressions), but not both in the same attribute.

**é‡è¦** ç”±äº JSX çš„è¯­æ³•æ›´åŠ æ¥è¿‘ JavaScript è€Œä¸æ˜¯ HTMLï¼Œæ‰€ä»¥ ReactDOM ä½¿ç”¨ `camelCase`ï¼ˆå°é©¼å³°å‘½åï¼‰æ¥å®šä¹‰å±æ€§çš„åç§°ï¼Œè€Œä¸ä½¿ç”¨ HTML å±æ€§åç§°çš„å‘½åçº¦å®šã€‚

æ¯”å¦‚ï¼š`class` -> `className`ã€`tabindex` -> `tabIndex`

### # Specifying Children with JSX

> If a tag is empty, you may close it immediately with `/>`ï¼Œlike XML:

```javascript
const element = <img src={user.avatarUrl}" />
```

> JSX tags may contain chilren:

```javascript
<div>
  <h1>Hello, {formatName(user)}</h1>
  <img src={user.avatarUrl} alt="avatar" />
</div>
```

> React ä¸­çš„ä¸€ä¸ªå¸¸è§æ¨¡å¼æ˜¯ä¸€ä¸ªç»„ä»¶è¿”å›å¤šä¸ªå…ƒç´ ã€‚Fragments å…è®¸ä½ å°†å­åˆ—è¡¨åˆ†ç»„ï¼Œè€Œæ— éœ€å‘ DOM æ·»åŠ é¢å¤–èŠ‚ç‚¹ã€‚

> `<></>` æ˜¯ `<React.Fragment></React.Fragment>` çš„ çŸ­è¯­æ³•ï¼›ä½†ä¸æ”¯æŒ key æˆ– å±æ€§

```javascript
<Fragment>
    <h1>Hello, {formatName(user)}</h1>
    <img src={user.avatarUrl} alt="avatar" />
</Fragment>

// ç­‰æ•ˆäº

<>
    <h1>Hello, {formatName(user)}</h1>
    <img src={user.avatarUrl} alt="avatar" />
</>
```

### # JSX Prevents Injection Attacks

å¯ä»¥å®‰å…¨åœ°åœ¨ JSX å½“ä¸­æ’å…¥ç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼š

```javascript
const title = response.potentiallyMaliciousInput
// ç›´æ¥ä½¿ç”¨æ˜¯å®‰å…¨çš„ï¼Œæ”¾å¿ƒå¤§èƒ†ä½¿ç”¨å§ ~
const element = <h1>{title}</h1>
```

ReactDOM åœ¨æ¸²æŸ“æ‰€æœ‰è¾“å…¥å†…å®¹ä¹‹å‰ï¼Œé»˜è®¤ä¼šè¿›è¡Œè½¬ä¹‰ã€‚å®ƒå¯ä»¥ç¡®ä¿åœ¨ä½ çš„åº”ç”¨ä¸­ï¼Œæ°¸è¿œä¸ä¼šæ³¨å…¥é‚£äº›å¹¶éè‡ªå·±æ˜ç¡®ç¼–å†™çš„å†…å®¹ã€‚æ‰€æœ‰çš„å†…å®¹åœ¨æ¸²æŸ“ä¹‹å‰éƒ½è¢«è½¬ä¹‰æˆäº†å­—ç¬¦ä¸²ï¼›å¯æœ‰æ•ˆé˜²æ­¢ `XSS (cross-site-scripting è·¨ç«™è„šæœ¬æ”»å‡»)` æ”»å‡»

### # JSX Represents Objects

> Babel compiles JSX down to `React.createElement()` calls.

Babel ä¼šæŠŠ JSX è½¬è¯‘æˆä¸€ä¸ªåä¸º `React.createElement()` å‡½æ•°è°ƒç”¨ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼š

```javascript
const element = <h1 className="greeting">Hello, world</h1>

// ç­‰æ•ˆäº

const element = React.createElement("h1", { className: "greeting" }, "Hello, world")

// å®é™…ä¸Šä¼šåˆ›å»ºç±»ä¼¼è¿™æ ·çš„ä¸€ä¸ªå¯¹è±¡ï¼š
// æ³¨æ„ï¼šè¿™é‡Œåªæ˜¯ç®€å•åœ°æè¿°è¿™ä¸ª JSX å¯¹è±¡çš„ç»“æ„
const element = {
  type: "h1",
  props: {
    className: "greeting",
    children: "Hello, world"
  }
}
```

## # Rendering Elements

> Elements are the smallest building blocks of React apps.

å…ƒç´ æ˜¯ React åº”ç”¨ç¨‹åºçš„æœ€å°æ„å»ºå—ã€‚

### # Rendering an Element into the DOM

```html
<!-- "root" DOM nodeï¼Œeverything inside it will be managed by React DOM -->
<div id="root"></div>
```

é€šå¸¸ï¼Œä½¿ç”¨ React æ„å»ºçš„åº”ç”¨åªæœ‰å•ä¸€çš„æ ¹ DOM èŠ‚ç‚¹ã€‚å¦‚æœæƒ³è¦å°†ä¸€ä¸ª React å…ƒç´ æ¸²æŸ“åˆ°æ ¹ DOM èŠ‚ç‚¹ä¸­ï¼Œåªéœ€è¦æŠŠå®ƒä»¬ä¸€èµ·ä¼ å…¥ `ReactDOM.render(element, container[, callback])`ã€‚

å°±åƒæœ€åˆçš„ `Hello, world` ä¾‹å­ä¸€æ ·ï¼š

```javascript
// vDom å°±æ˜¯ â€œReact å…ƒç´ â€
const vDom = <h1>Hello, world!</h1>
ReactDOM.render(vDom, document.querySelector("#app"))
```

### # Updating the Rendered Element

> React elements are `immutable`. Once you create an element, you can't change its children or attributes.

é‚£ä¹ˆï¼Œåœ¨å½“å‰ï¼ˆå‰é¢å·²äº†è§£åˆ°çš„çŸ¥è¯†ï¼‰æˆ‘ä»¬è¯¥å¦‚ä½•æ›´æ–°å·²æ¸²æŸ“çš„å…ƒç´ å‘¢ï¼Ÿ

å”¯ä¸€çš„æ–¹å¼å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ React å…ƒç´ ï¼Œå¹¶å°†å…¶ä¼ å…¥åˆ° `ReactDOM.render(element, container[, callback])` ï¼Œé‡æ–°æ¸²æŸ“åˆ°æ ¹èŠ‚ç‚¹ï¼š

```javascript
const tick = () => {
  const element = (
    <>
      <h1 className="name-purple">Hello, Nicholas</h1>
      <h2>TIME: {new Date().toLocaleTimeString()}</h2>
    </>
  )

  ReactDOM.render(element, document.querySelector("#app"))
}

setInterval(tick, 1000)
```

> **æ³¨æ„ï¼š** åœ¨å®é™…çš„ React åº”ç”¨ä¸­åªä¼šè°ƒç”¨ä¸€æ¬¡ `ReactDOM.render(element, container[, callback])`;

### # React Only Updates What's Necessary

> React DOM compares the element and its children to the previous one, and only applies the DOM updates necessary to bring the DOM to the desired state.

![](./rendering-elements.gif)

ä»ä¸Šå›¾å¯ä»¥æ¸…æ™°çœ‹åˆ°ï¼Œå°½ç®¡æ¯ä¸€ç§’æˆ‘ä»¬éƒ½ä¼šæ–°åˆ›å»ºä¸€ä¸ªæè¿°æ•´ä¸ª UI æ ‘çš„å…ƒç´ ï¼ŒReact DOM åªä¼šæ›´æ–°å®é™…æ”¹å˜äº†çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ä¾‹å­ä¸­çš„æ–‡æœ¬èŠ‚ç‚¹ã€‚

## # Components and Props

> Components let you split the UI into independent, reusable pieces and think about each piece in isolation.

ç»„ä»¶å…è®¸ä½ å°† UI æ‹†åˆ†ä¸ºç‹¬ç«‹çš„ã€å¯å¤ç”¨çš„ä»£ç ç‰‡æ®µï¼Œå¹¶å•ç‹¬è€ƒè™‘æ¯ä¸ªä»£ç ç‰‡æ®µã€‚

Conceptually, components are like JavaScript functions. They accept arbitrary(ä»»æ„åœ°) inputs (called "props") and return React elements describing what should appear on the screen.

### # æ¨¡å—ä¸ç»„ä»¶ å’Œ æ¨¡å—åŒ–ä¸ç»„ä»¶åŒ–

- **æ¨¡å—**

æ¨¡å—å°±æ˜¯å‘å¤–æä¾›ç‰¹å®šåŠŸèƒ½çš„ js ç¨‹åºï¼Œä¸€èˆ¬å°±æ˜¯ä¸€ä¸ª js æ–‡ä»¶ï¼›ç›®çš„æ˜¯ä¸ºäº†å¤ç”¨ js ï¼Œç®€åŒ– js çš„ç¼–å†™ï¼Œæé«˜ js è¿è¡Œæ•ˆç‡ã€‚

- **ç»„ä»¶**

ç”¨æ¥å®ç°ç‰¹å®šï¼ˆå±€éƒ¨ï¼‰åŠŸèƒ½æ•ˆæœçš„ä»£ç é›†åˆï¼ˆhtml/css/jsï¼‰ï¼Œåœ¨è¾ƒé«˜å±‚é¢ä¸Šæ¥çœ‹ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„åŒ…å«ç‰¹å®šåŠ¨èƒ½çš„å…ƒç´ ã€‚

### # Function and Class Components

```javascript
// 1. Function Components
// æ¥æ”¶å”¯ä¸€å¸¦æœ‰æ•°æ®çš„ "props"
const FunComponent = props => {
  console.log(props)
  return (
    <>
      <h1>Hello, {props.name}</h1>
      <h3>Function Components (å‡½æ•°ç»„ä»¶ â€”â€” ç®€å•ç»„ä»¶)</h3>
    </>
  )
}

// æ¸²æŸ“ç»„ä»¶
ReactDOM.render(<FunComponent name="Nicholas" />, document.querySelector("#rootByFunComponents"))

// 2. Class Components
class ClassComponent extends React.Component {
  render() {
    // æ‰“å°å®ä¾‹å¯¹è±¡
    console.log(this)
    return (
      <>
        <h1>Hello, {this.props.name}</h1>
        <h3>Class Components (ES6ç±»ç»„ä»¶ â€”â€” å¤æ‚ç»„ä»¶)</h3>
      </>
    )
  }
}

// æ¸²æŸ“ç»„ä»¶
ReactDOM.render(<ClassComponent name="Nicholas1" />, document.querySelector("#rootByClassComponents"))
```

> **æ³¨æ„ï¼šç»„ä»¶åç§°å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ã€‚**
>
> React ä¼šå°†ä»¥å°å†™å­—æ¯å¼€å¤´çš„ç»„ä»¶è§†ä¸ºåŸç”Ÿ DOM æ ‡ç­¾ã€‚

### # Composing Components

å®šä¹‰ç»„ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥å¼•ç”¨å…¶ä»–ç»„ä»¶ã€‚åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åŒä¸€ç»„ä»¶æŠ½è±¡å‡ºä»»æ„å±‚æ¬¡çš„ç»†èŠ‚ã€‚æŒ‰é’®ã€è¡¨å•ã€å¯¹è¯æ¡†ã€ç”šè‡³æ•´ä¸ªå±å¹•çš„å†…å®¹ï¼šåœ¨ React åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™äº›é€šå¸¸éƒ½ä¼šä»¥ç»„ä»¶çš„å½¢å¼è¡¨ç¤ºã€‚

```javascript
// ç»„åˆç»„ä»¶
const HelloComponent = props => {
  return <h1>Hello, {props.name}</h1>
}

const App = () => {
  return (
    <>
      <HelloComponent name="Nicholas" />
      <HelloComponent name="Sara" />
      <HelloComponent name="Ethan" />
    </>
  )
}

ReactDOM.render(<App />, document.querySelector("#rootByFunComponents"))
```

### # Props

`props` æ˜¯ç”¨äºæ•´ä¸ªç»„ä»¶æ ‘ä¸­ `ä¼ é€’æ•°æ®` å’Œ `é…ç½®`ï¼›åœ¨å½“å‰ç»„ä»¶è®¿é—® `props`ï¼Œä½¿ç”¨ `this.props`ã€‚

ç»„ä»¶æ— è®ºä½¿ç”¨å‡½æ•°å£°æ˜è¿˜æ˜¯é€šè¿‡ class å£°æ˜ï¼Œéƒ½å†³ä¸èƒ½ä¿®æ”¹è‡ªèº«çš„ `props`ã€‚

> æ‰€æœ‰ React ç»„ä»¶éƒ½å¿…é¡»åƒçº¯å‡½æ•°ä¸€æ ·ä¿æŠ¤å®ƒä»¬çš„ props ä¸è¢«æ›´æ”¹ã€‚

#### # éœ€æ±‚ï¼šè‡ªå®šä¹‰ä¸€ä¸ªç»„ä»¶ï¼Œç”¨æ¥æ˜¾ç¤ºä¸€ä¸ªäººå‘˜ä¿¡æ¯

è¯´æ˜ï¼š1.å¦‚æœæ€§åˆ«æ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸ºâ€œç”·â€œï¼›2.å¦‚æœå¹´é¾„æ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸ºâ€œ18â€

```javascript
/**
 * éœ€æ±‚ï¼šè‡ªå®šä¹‰ä¸€ä¸ªç»„ä»¶ï¼Œç”¨æ¥æ˜¾ç¤ºä¸€ä¸ªäººå‘˜ä¿¡æ¯
 * è¯´æ˜ï¼š1.å¦‚æœæ€§åˆ«æ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸ºâ€œç”·â€œï¼›2.å¦‚æœå¹´é¾„æ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸ºâ€œ18â€
 */
const Person = props => {
  console.log(props)
  return (
    <>
      <div>Name: {props.name}</div>
      <div>Age: {props.age}</div>
      <div>Sex: {props.sex}</div>
    </>
  )
}

// class Person extends React.Component {
//     render () {
//         console.log(this)
//         return (
//             <>
//                 <div>Name: { this.props.name }</div>
//                 <div>Age: { this.props.age }</div>
//                 <div>Sex: { this.props.sex }</div>
//             </>
//         )
//     }
// }

// defaultProps
// å¯ä»¥ä¸ºç»„ä»¶æ·»åŠ é»˜è®¤ propsã€‚è¿™ä¸€èˆ¬ç”¨äº props æœªèµ‹å€¼ï¼Œä½†åˆä¸èƒ½ä¸º null çš„æƒ…å†µ
Person.defaultProps = {
  age: 18,
  sex: "Male"
}

const UserName = {
  name: "Nicholas",
  age: 20
}

let element = <Person name={UserName.name} age={UserName.age} sex={UserName.sex} />

const container = document.querySelector("#rootByFunComponents")

// ç»„ä»¶å±æ€§è®¾ç½®çš„ä¸¤ç§æ–¹å¼ï¼ˆæš‚æ—¶å·²çŸ¥çš„ ğŸ˜‚ï¼‰

// 1. æ˜¾ç¤ºæŒ‡å®šå„ä¸ªå±æ€§ï¼šï¼ˆJavaScriptè¡¨è¾¾å¼ï¼Œå­—ç¬¦ä¸²å­—é¢é‡ï¼ŒPropsé»˜è®¤å€¼ä¸º â€Trueâ€œï¼‰
// ReactDOM.render(element, container);

// 2. ä½¿ç”¨ ES6 çš„æ‰©å±•ç¬¦ Spread Attributes
ReactDOM.render(<Person {...UserName} />, container)
```

## # State and Lifecycle

åœ¨å…ƒç´ æ¸²æŸ“ç« èŠ‚ï¼Œæˆ‘ä»¬äº†è§£äº†ä¸€ç§æ›´æ–° UI ç•Œé¢çš„æ–¹æ³•ï¼šé€šè¿‡è°ƒç”¨ `ReactDOM.render()` æ¥ä¿®æ”¹éœ€è¦æ¸²æŸ“çš„å…ƒç´ 

```javascript
const tick = () => {
  const element = (
    <>
      <h1 className="name-purple">Hello, Nicholas</h1>
      <h2>TIME: {new Date().toLocaleTimeString()}</h2>
    </>
  )

  ReactDOM.render(element, document.querySelector("#app"))
}

setInterval(tick, 1000)
```

æœ¬ç« èŠ‚å°†åŸºäºè¿™ä¸ªä¾‹å­ç»§ç»­å­¦ä¹ å¦å¤–çš„å®ç° UI ç•Œé¢æ›´æ–°çš„æ–¹æ³•ã€‚

### # éœ€æ±‚ï¼šå°è£…ä¸€ä¸ªå¯å¤ç”¨çš„ `Clock` ç»„ä»¶

```javascript
/**
 * éœ€æ±‚ï¼šå°è£…çœŸæ­£å¯å¤ç”¨çš„ Clock ç»„ä»¶
 */
const Clock = props => {
  return (
    <>
      <h1>Hello, {props.name}</h1>
      <h2>{props.date.toLocaleTimeString()}</h2>
    </>
  )
}

const container = document.querySelector("#app")

const tick = () => {
  ReactDOM.render(<Clock date={new Date()} />, container)
}

setInterval(tick, 1000)
```

ä½†æ˜¯ï¼Œä¸Šé¢çš„å®ç°ç¼ºå°‘äº†ä¸€ä¸ªå…³é”®çš„æŠ€æœ¯ç»†èŠ‚ï¼š`Clock` ç»„ä»¶éœ€è¦è®¾ç½®ä¸€ä¸ªè‡ªå·±çš„è®¡æ—¶å™¨å¹¶æ¯ç§’æ›´æ–°ä¸€æ¬¡ã€‚

ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›åªç¼–å†™ä¸€æ¬¡æ¸²æŸ“ä»£ç ï¼Œä¾¿å¯è®© `Clock` ç»„ä»¶å®ç°è‡ªæˆ‘æ›´æ–°ã€‚

å¦‚æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼šState ã€‚State ä¸ Props ç±»ä¼¼ï¼Œä½†æ˜¯ state æ˜¯ç§æœ‰çš„ï¼Œå¹¶ä¸”å®Œå…¨å—æ§äºå½“å‰ç»„ä»¶ã€‚

> State æœ¬è´¨æ§åˆ¶çš„æ˜¯ç»„ä»¶çŠ¶æ€ï¼Œè€Œå‡½æ•°ç»„ä»¶æ˜¯æ— çŠ¶æ€ç»„ä»¶ï¼Œæ‰€ä»¥å½“ä½¿ç”¨ state æ—¶ï¼Œå¿…é¡»æ˜¯åœ¨ Class ç»„ä»¶é‡Œé¢ä½¿ç”¨

```javascript
/**
 * éœ€æ±‚ï¼šå°è£…çœŸæ­£å¯å¤ç”¨çš„ Clock ç»„ä»¶
 * è¯´æ˜ï¼šå°†å‡½æ•°ç»„ä»¶è½¬æ¢æˆ class ç»„ä»¶
 */
// 1. åˆ›å»ºä¸€ä¸ªåŒåçš„ ES6 class, å¹¶ç»§æ‰¿äº `React.Component`
// 2. æ·»åŠ ä¸€ä¸ªç©ºçš„ `render()` æ–¹æ³•
// 3. å°†å‡½æ•°ä½“ç§»åˆ° `render()` æ–¹æ³•ä¹‹ä¸­
// 4. åœ¨ `render()` æ–¹æ³•ä¸­ä½¿ç”¨ `this.props` æ›¿æ¢ `props`
// 5. ç§»é™¤ `setInterval()` æ–¹æ³•ï¼Œåªä¿ç•™ `ReactDOM.render()`
class Clock extends React.Component {
  render() {
    return (
      <>
        <h1>Hello, {this.props.name}</h1>
        <h2>{this.props.date.toLocaleTimeString()}</h2>
      </>
    )
  }
}

const container = document.querySelector("#app")

ReactDOM.render(<Clock date={new Date()} />, container)
```

ç°åœ¨ `Clock` ç»„ä»¶è¢«å®šä¹‰ä¸º classï¼Œè€Œä¸æ˜¯å‡½æ•°ã€‚

æ¯æ¬¡ç»„ä»¶æ›´æ–°æ—¶ `render` æ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä½†åªè¦åœ¨ç›¸åŒçš„ DOM èŠ‚ç‚¹ä¸­æ¸²æŸ“ `<Clock />`ï¼Œå°±ä»…æœ‰ä¸€ä¸ª `Clock` ç»„ä»¶çš„ class å®ä¾‹è¢«åˆ›å»ºä½¿ç”¨ã€‚

```javascript
/**
 * éœ€æ±‚ï¼šå°è£…çœŸæ­£å¯å¤ç”¨çš„ Clock ç»„ä»¶
 * è¯´æ˜ï¼šå‘ class ç»„ä»¶ä¸­æ·»åŠ å±€éƒ¨çš„ state
 */
class Clock extends React.Component {
  // Class ç»„ä»¶åº”è¯¥å§‹ç»ˆä½¿ç”¨ props å‚æ•°æ¥è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°
  constructor(props) {
    super(props)
    // this.state èµ‹åˆå€¼
    this.state = { date: new Date() }
  }

  render() {
    return (
      <>
        <h1>Hello, {this.props.name}</h1>
        <h2>{this.state.date.toLocaleTimeString()}</h2>
      </>
    )
  }
}

const container = document.querySelector("#app")

ReactDOM.render(<Clock name="Nicholas" />, container)
```

> Class ç»„ä»¶åº”è¯¥å§‹ç»ˆä½¿ç”¨ `props` å‚æ•°æ¥è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°

```javascript
/**
 * éœ€æ±‚ï¼šå°è£…çœŸæ­£å¯å¤ç”¨çš„ Clock ç»„ä»¶
 * è¯´æ˜ï¼šè®¾ç½®è‡ªå·±çš„è®¡æ—¶å™¨å¹¶æ¯ç§’æ›´æ–°ä¸€æ¬¡ â€”â€” é€šè¿‡ç”Ÿå‘½å‘¨æœŸå‡½æ•°å®ç° state è‡ªåŠ¨æ›´æ–°
 */
class Clock extends React.Component {
  // Class ç»„ä»¶åº”è¯¥å§‹ç»ˆä½¿ç”¨ props å‚æ•°æ¥è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°
  constructor(props) {
    super(props)
    // this.state èµ‹åˆå€¼
    this.state = { date: new Date() }
  }

  // `componentDidMount()` æ–¹æ³•ä¼šåœ¨ç»„ä»¶å·²ç»è¢«æ¸²æŸ“åˆ° DOM ä¸­åè¿è¡Œ
  componentDidMount() {
    this.timerId = setInterval(() => this.tick(), 1000)
  }

  componentWillUnmount() {
    clearInterval(this.timerId)
  }

  tick() {
    this.setState({
      date: new Date()
    })
  }

  render() {
    return (
      <>
        <h1>Hello, {this.props.name}</h1>
        <h2>{this.state.date.toLocaleTimeString()}</h2>
      </>
    )
  }
}

const container = document.querySelector("#app")

ReactDOM.render(<Clock name="Nicholas" />, container)
```

1. å½“ `<Clock />` ä¼ ç»™ `ReactDOM.render()` çš„æ—¶å€™ï¼ŒReact ä¼šè°ƒç”¨ `Clock` ç»„ä»¶çš„æ„é€ å‡½æ•°ï¼šåˆå§‹åŒ– `this.state`;

2. ä¹‹å React ä¼šè°ƒç”¨ç»„ä»¶çš„ `render()` æ–¹æ³•ï¼Œå°†ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Šæ˜¾ç¤ºï¼›

3. å½“ `Clock` ç»„ä»¶æ’å…¥åˆ° DOM ä¸­åï¼ŒReact å°±ä¼šè°ƒç”¨ `ComponentDidMount()` ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼›

4. `ComponentDidMount()` æ–¹æ³•ä¸­å®ç°äº†ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œæµè§ˆå™¨æ¯ç§’éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡ `tick()` æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œ`Clock` ç»„ä»¶ä¼šé€šè¿‡è°ƒç”¨ `setState()` æ¥æ›´æ–°çŠ¶æ€ï¼Œå½“çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼ŒReact ä¾¿ä¼šé‡æ–°è°ƒç”¨ `render()` æ–¹æ³•æ¥ç¡®å®šé¡µé¢ä¸Šè¯¥æ˜¾ç¤ºä»€ä¹ˆã€‚`this.state.date` å‘ç”Ÿæ”¹å˜ï¼ŒReact ä¼šç›¸åº”çš„æ›´æ–° DOMï¼›

5. ä¸€æ—¦ `Clock` ç»„ä»¶ä» DOM ä¸­è¢«ç§»é™¤ï¼ŒReact å°±ä¼šè°ƒç”¨ `componentWillUnmount()` ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼›

### # æ­£ç¡®åœ°ä½¿ç”¨ `State`

å…³äº `setState()` éœ€è¦æ³¨æ„ï¼š

- ä¸è¦ç›´æ¥ä¿®æ”¹ `State` ï¼›æ„é€ å‡½æ•°æ˜¯å”¯ä¸€å¯ä»¥ç»™ `this.state` èµ‹å€¼çš„åœ°æ–¹

```javascript
// Wrong
this.state.comment = "Hello"

// Correct
this.setState({ comment: "Hello" })
```

- `State` çš„æ›´æ–°å¯èƒ½æ˜¯å¼‚æ­¥çš„

  å‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼ŒReact å¯èƒ½ä¼šæŠŠå¤šä¸ª `setState()` è°ƒç”¨åˆå¹¶æˆä¸€ä¸ªè°ƒç”¨ï¼›

  ç”±äº `this.props` å’Œ `this.state` å¯èƒ½ä¼šå¼‚æ­¥æ›´æ–°ï¼Œæ‰€ä»¥ä¸è¦ä¾èµ–ä»–ä»¬çš„å€¼æ¥æ›´æ–°ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼›

  è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è®© `setState()` æ¥æ”¶ä¸€ä¸ªå‡½æ•°è€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ `state`, ç¬¬äºŒä¸ªå‚æ•°æ˜¯ `props`ï¼Œä¸”è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼›

```javascript
// Wrong
this.setState({
  counter: this.state.counter + this.props.increment
})

// Correct
this.setState(function(state, props) {
  return {
    counter: state.counter + props.increment
  }
})

// æˆ–è€…ä½¿ç”¨ç®­å¤´å‡½æ•°
this.setState((state, props) => ({
  counter: state.counter + props.increment
}))
```

- `State` çš„æ›´æ–°ä¼šè¢«åˆå¹¶

  å½“ä½ è°ƒç”¨ `setState()` çš„æ—¶å€™ï¼ŒReact ä¼šæŠŠä½ æä¾›çš„å¯¹è±¡åˆå¹¶ï¼ˆæµ…åˆå¹¶ï¼‰åˆ°å½“å‰çš„ `state`;

```javascript
// ä¾‹å¦‚ï¼šstate ä¸­åŒ…å«å‡ ä¸ªç‹¬ç«‹çš„å˜é‡
constructor(props) {
    super(props)
    this.state = {
        posts: [],
        comments: []
    }
}

// ç„¶åå¯ä»¥åˆ†åˆ«è°ƒç”¨ `setState()` æ¥å•ç‹¬åœ°æ›´æ–°å®ƒä»¬
componentDidMount() {
    fetchPosts().then(response => {
        this.setState({
            posts: response.posts
        })
    })

    fetchComments().then(response => {
        // å®Œæ•´ä¿ç•™äº† `this.state.posts`ï¼Œä½†å®Œå…¨æ›¿æ¢äº† `this.state.comments`
        this.setState({
            comments: response.comments
        })
    })
}
```

### # æ•°æ®æ˜¯å‘ä¸‹æµåŠ¨çš„

> Neither parent nor child components can know if a certain(æŸäº›ã€æŸä¸ª) component is stateful or statelessï¼Œ and they shoudn't care whether it is defined as a function or a class.

ä¸ç®¡çˆ¶ç»„ä»¶è¿˜æ˜¯å­ç»„ä»¶éƒ½æ— æ³•çŸ¥é“æŸä¸ªç»„ä»¶æ˜¯æœ‰çŠ¶æ€çš„è¿˜æ˜¯æ— çŠ¶æ€çš„ï¼Œå¹¶ä¸”å®ƒä»¬ä¹Ÿå¹¶ä¸å…³å¿ƒå®ƒæ˜¯å‡½æ•°ç»„ä»¶è¿˜æ˜¯ class ç»„ä»¶ã€‚

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç§° `state` ä¸ºå±€éƒ¨çš„æˆ–æ˜¯å°è£…çš„åŸå› ã€‚

```html
<!-- ç»„ä»¶å¯ä»¥é€‰æ‹©æŠŠå®ƒçš„ state ä½œä¸º props å‘ä¸‹ä¼ é€’åˆ°å®ƒçš„å­ç»„ä»¶ä¸­ -->
<h2>{ this.state.date.toLocaleTimeString() }</h2>

<!-- è¿™å¯¹äºè‡ªå®šä¹‰ç»„ä»¶åŒæ ·é€‚ç”¨ -->
<FomatterDate date="{" this.state.date } />
```

ç»„ä»¶æœ¬èº«æ— æ³•çŸ¥é“å®ƒåŸæ¥æ˜¯æ¥è‡ªäºçˆ¶ç»„ä»¶çš„ state è¿˜æ˜¯çˆ¶ç»„ä»¶çš„ props ï¼Œè¿˜æ˜¯æ‰‹åŠ¨è¾“å…¥çš„ï¼š

```javascript
function FormattedDate(props) {
  return <h2>{props.date.toLocaleTimeString()}</h2>
}
```

è¿™é€šå¸¸è¢«å«åš **è‡ªä¸Šè€Œä¸‹ï¼ˆtop-downï¼‰** æˆ–æ˜¯ **å•å‘ï¼ˆunidirectionalï¼‰** çš„æ•°æ®æµã€‚ä»»ä½•çš„ state æ€»æ˜¯æ‰€å±äºç‰¹å®šçš„ç»„ä»¶ï¼Œè€Œä¸”ä»è¯¥ state æ´¾ç”Ÿçš„ä»»ä½•æ•°æ®æˆ– UI åªèƒ½å½±å“æ ‘ä¸­â€ä½äºâ€œå®ƒä»¬çš„ç»„ä»¶ã€‚

> **å°½å¯èƒ½ä½¿ç”¨ `props` å½“åšæ•°æ®æºï¼Œ`state` ç”¨æ¥å­˜æ”¾çŠ¶æ€å€¼ï¼ˆç®€å•çš„æ•°æ®ï¼‰**

### # éœ€æ±‚ï¼šå®ç°ä¸€ä¸ªæ‰‹åŠ¨è®¡æ•°çš„åº”ç”¨ï¼ˆä¸€ï¼‰

è¯´æ˜ï¼šè®¾è®¡ä¸€ä¸ª button çš„ç®€å•æ‰‹åŠ¨è®¡æ•°å™¨åº”ç”¨ï¼Œç‚¹å‡» "+" button è®¡æ•°å™¨å¢åŠ  1ï¼Œç‚¹å‡» "-" button è®¡æ•°å™¨å‡ 1ï¼›

```javascript
/**
 * éœ€æ±‚ï¼šå®ç°ä¸€ä¸ªæ‰‹åŠ¨è®¡æ•°çš„åº”ç”¨
 * è¯´æ˜ï¼šè®¾è®¡ä¸€ä¸ª button çš„ç®€å•æ‰‹åŠ¨è®¡æ•°å™¨åº”ç”¨ï¼Œç‚¹å‡» "+" button è®¡æ•°å™¨å¢åŠ 1ï¼Œç‚¹å‡» "-" button è®¡æ•°å™¨å‡1ï¼›
 */
class Counter extends React.Component {
  constructor(props) {
    super(props)

    this.state = {
      initValue: 0
    }

    // ä¸ render å‡½æ•°çš„ onClick ç»‘å®šï¼Œå°† this ç»‘å®šä¸ºç»„ä»¶å¯¹è±¡
    this.onClickAdd = this.onClickAdd.bind(this)
    this.onClickReduce = this.onClickReduce.bind(this)
  }

  onClickAdd() {
    // å†…éƒ¨çš„ this é»˜è®¤ä¸æ˜¯ç»„ä»¶å¯¹è±¡ï¼Œè€Œæ˜¯ undefinedï¼›éœ€è¦ä¸»åŠ¨å¼ºåˆ¶ç»‘å®šç»„ä»¶å¯¹è±¡
    console.log(this)
    // è¯»å–çŠ¶æ€å¹¶è®¡ç®—
    this.state.initValue++
    // æ›´æ–°çŠ¶æ€ state
    this.setState({
      initValue: this.state.initValue
    })
  }

  onClickReduce() {
    console.log(this)
    this.state.initValue--
    this.setState({
      initValue: this.state.initValue
    })
  }

  render() {
    return (
      <div className="container">
        <button onClick={this.onClickAdd}> + </button>
        <span>è®¡æ•°ï¼š{this.state.initValue}</span>
        <button onClick={this.onClickReduce}> - </button>
      </div>
    )
  }
}

const container = document.querySelector("#app")

ReactDOM.render(<Counter initValue="0" />, container)
```

### # éœ€æ±‚ï¼šå®ç°ä¸€ä¸ªæ‰‹åŠ¨è®¡æ•°çš„åº”ç”¨ï¼ˆäºŒï¼‰

è¯´æ˜ï¼š

1. è®¾è®¡ä¸€ä¸ª button çš„ç®€å•æ‰‹åŠ¨è®¡æ•°å™¨åº”ç”¨ï¼Œç‚¹å‡» "+" button è®¡æ•°å™¨å¢åŠ  1ï¼Œç‚¹å‡» "-" button è®¡æ•°å™¨å‡ 1ï¼›

2. ä¸‰ä¸ªåŒæ ·çš„è®¡æ•°å™¨æ‰‹åŠ¨è®¡æ•°ï¼Œç„¶åç®—å‡ºæœ€ç»ˆçš„è®¡æ•°ç»“æœï¼Œå¹¶å±•ç¤º

   ![](./button-counter.png)

```javascript
// Parent Component
class TotalCount extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      totalValue: 0
    }

    this.updateCount = this.updateCount.bind(this)
  }

  updateCount(preValue, newValue) {
    this.setState({
      totalValue: this.state.totalValue + (newValue - preValue)
    })
  }

  render() {
    return (
      <div className="container">
        // å°† updateCount ä½œä¸º props ä¼ é€’ç»™ Child Component
        <Counter aValue="0" updateCount={this.updateCount} />
        <br />
        <br />
        <Counter aValue="0" updateCount={this.updateCount} />
        <br />
        <br />
        <Counter aValue="0" updateCount={this.updateCount} />
        <hr />
        <div> Total Count: {this.state.totalValue} </div>
      </div>
    )
  }
}

// Child Component
class Counter extends React.Component {
  constructor(props) {
    super(props)

    this.state = {
      initValue: this.props.aValue
    }

    // ä¸ render å‡½æ•°çš„ onClick ç»‘å®šï¼Œå°† this ç»‘å®šä¸ºç»„ä»¶å¯¹è±¡
    this.onClickAdd = this.onClickAdd.bind(this)
    this.onClickReduce = this.onClickReduce.bind(this)
  }

  onClickAdd() {
    this.handleUpdateValue(true)
  }

  onClickReduce() {
    this.handleUpdateValue(false)
  }

  handleUpdateValue(flag) {
    const preValue = this.state.initValue
    const newValue = flag ? ++this.state.initValue : --this.state.initValue
    this.setState({
      initValue: newValue
    })
    // é‡è¦ï¼šè¿™é‡Œå°†å‡½æ•°ä½œä¸ºä¸€ä¸ª props æ¥ä¼ é€’æ•°æ®
    this.props.updateCount(preValue, newValue)
  }

  render() {
    return (
      <>
        <button onClick={this.onClickAdd}> + </button>
        <span>è®¡æ•°ï¼š{this.state.initValue}</span>
        <button onClick={this.onClickReduce}> - </button>
      </>
    )
  }
}

const container = document.querySelector("#app")

ReactDOM.render(<TotalCount />, container)
```

## # Handling Events

> Handling events with React elements is very similar to handling events on DOM elements.

ä½†æ˜¯æœ‰ä¸€ç‚¹è¯­æ³•ä¸Šçš„ä¸åŒï¼š

- React äº‹ä»¶çš„å‘½åé‡‡ç”¨å°é©¼å³°å¼ï¼ˆcamelCaseï¼‰ï¼Œè€Œä¸æ˜¯çº¯å°å†™

- ä½¿ç”¨ JSX è¯­æ³•æ—¶ä½ éœ€è¦ä¼ å…¥ä¸€ä¸ªå‡½æ•°ä½œä¸ºäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²

```html
<!-- DOM å…ƒç´ äº‹ä»¶å¤„ç† -->
<button onclick="activateLasers()">
  Activate Lasers
</button>

<!-- React å…ƒç´ äº‹ä»¶å¤„ç† -->
<button onClick="{" activateLasers }>
  Activate Lasers
</button>
```

- React ä¸­ä¸èƒ½é€šè¿‡è¿”å› `false` çš„æ–¹å¼é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œå¿…é¡»æ˜¾å¼çš„ä½¿ç”¨ `preventDefault`

```html
<!-- ä¼ ç»Ÿ html ä¸­ -->
<a herf="#" onclick="console.log('The link was clicked.') return false">
  Click Me
</a>
```

```javascript
// åœ¨ React ä¸­
const ActionLink = () => {
  const handleClick = e => {
    e.preventDefault()
    console.log("The link was clicked.")
  }

  return (
    <a herf="#" onClick={handleClick}>
      Click Me
    </a>
  )
}
```

ä½¿ç”¨ React æ—¶ï¼Œä¸€èˆ¬ä¸éœ€è¦ä½¿ç”¨ `addEventListener` ä¸ºå·²åˆ›å»ºçš„ DOM å…ƒç´ æ·»åŠ ç›‘å¬å™¨ï¼›é€šå¸¸åªéœ€è¦åœ¨è¯¥å…ƒç´ åˆå§‹æ¸²æŸ“çš„æ—¶å€™æ·»åŠ ç›‘å¬å™¨å³å¯ã€‚

```javascript
class Toggle extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      isToggleOn: true
    }

    // This binding is necessary to make `this` work in the callback
    this.handleClick = this.handleClick.bind(this)
  }

  handleClick() {
    console.log(this)
    this.setState(state => ({ isToggleOn: !state.isToggleOn }))
  }

  render() {
    return <button onClick={this.handleClick}>{this.state.isToggleOn ? "ON" : "OFF"}</button>
  }
}

ReactDOM.render(<Toggle />, document.querySelector("#app"))
```

**å¿…é¡»è°¨æ…å¯¹å¾… JSX å›è°ƒå‡½æ•°ä¸­çš„ `this`**ï¼Œåœ¨ JavaScript ä¸­ï¼Œclass çš„æ–¹æ³•é»˜è®¤ä¸ä¼šç»‘å®š `this`ã€‚

å¦‚æœè§‰å¾—ä½¿ç”¨ `bind()` æ–¹æ³•ç»‘å®š `this` å¾ˆéº»çƒ¦ï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è§£å†³ï¼š

- å¦‚æœä½ æ­£åœ¨ä½¿ç”¨å®éªŒæ€§çš„ `public class fields` è¯­æ³•ï¼Œä½ å¯ä»¥ä½¿ç”¨ class fields æ­£ç¡®çš„ç»‘å®šå›è°ƒå‡½æ•°ï¼›

```javascript
class LoggingButton extends React.Component {
  // This syntax ensures `this` is bound within handleClick.
  // Warning: this is *experimental* syntax.
  handleClick = () => {
    console.log("this is:", this)
  }

  render() {
    return <button onClick={this.handleClick}>Click Me</button>
  }
}
```

**é‡è¦**ï¼š`Create React App` é»˜è®¤å¯ç”¨æ­¤è¯­æ³•

- å¦‚æœæ²¡æœ‰ä½¿ç”¨ class fields è¯­æ³•ï¼Œä½ å¯ä»¥åœ¨å›è°ƒä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼ˆarrow functionï¼‰;

```javascript
class LoggingButton extends React.Component {
  handleClick() {
    console.log("this is:", this)
  }

  render() {
    // This syntax ensures `this` is bound within handleClick.
    // ä¸æ¨èè¿™ç§å†™æ³•
    return <button onClick={e => this.handleClick(e)}>Click Me</button>
  }
}
```

ä½†æ­¤è¯­æ³•çš„é—®é¢˜åœ¨äºæ¯æ¬¡æ¸²æŸ“ `LoggingButton` æ—¶éƒ½ä¼šåˆ›å»ºä¸åŒçš„å›è°ƒå‡½æ•°ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ï¼Œä½†å¦‚æœè¯¥å›è°ƒå‡½æ•°ä½œä¸º prop ä¼ å…¥å­ç»„ä»¶æ—¶ï¼Œè¿™äº›ç»„ä»¶å¯èƒ½ä¼šè¿›è¡Œé¢å¤–çš„é‡æ–°æ¸²æŸ“ã€‚

é€šå¸¸å»ºè®®åœ¨æ„é€ å™¨ä¸­ç»‘å®šæˆ–è€…ä½¿ç”¨ class fields è¯­æ³•æ¥é¿å…è¿™ç±»æ€§èƒ½é—®é¢˜ã€‚

### # Passing Arguments to Event Handlers

åœ¨å¾ªç¯ä¸­ï¼Œé€šå¸¸éœ€è¦ä¸ºäº‹ä»¶å¤„ç†å‡½æ•°ä¼ é€’é¢å¤–çš„å‚æ•°ï¼›

```html
<button onClick={ (e) => this.deleteRow(id, e) }>Delete Row</button>
<button onClick={ this.deleteRow.bind(this, id) }></button>
```

ä¸Šè¿°ä¸¤ç§æ–¹å¼æ—¶ç­‰ä»·çš„ï¼Œåˆ†åˆ«é€šè¿‡ `ç®­å¤´å‡½æ•°` å’Œ `Function.prototype.bind` æ¥å®ç°ï¼›é€šè¿‡ç®­å¤´å‡½æ•°çš„æ–¹å¼ï¼Œäº‹ä»¶å¯¹è±¡å¿…é¡»æ˜¾å¼çš„è¿›è¡Œä¼ é€’ï¼Œè€Œé€šè¿‡ `bind` çš„æ–¹å¼ï¼Œäº‹ä»¶å¯¹è±¡ä»¥åŠæ›´è¿‡çš„å‚æ•°å°†ä¼šè¢«éšå¼çš„è¿›è¡Œä¼ é€’ã€‚

## # Conditional Rendering

> In Reactï¼Œyou can create distinct components that encapsulate behavior you need. Then, you can render only some of them, depending on the state of your application.

```javascript
const UserGreeting = props => {
  return <h1>Welcom back!</h1>
}

const GuestGreeting = props => {
  return <h1>Please sign up.</h1>
}

const Greeting = props => {
  const isLoggedIn = props.isLoggedIn
  if (isLoggedIn) {
    return <UserGreeting />
  }
  return <GuestGreeting />
}

ReactDOM.render(<Greeting isLoggedIn={false} />, document.querySelector("#app"))
```

### # Element Variables

å¯ä»¥ä½¿ç”¨å˜é‡æ¥å­˜å‚¨å…ƒç´ ã€‚å®ƒå¯ä»¥å¸®åŠ©ä½ æœ‰æ¡ä»¶åœ°æ¸²æŸ“ç»„ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œè€Œå…¶ä»–çš„æ¸²æŸ“éƒ¨åˆ†å¹¶ä¸ä¼šå› æ­¤è€Œæ”¹å˜ã€‚

```javascript
const UserGreeting = props => {
  return <h1>Welcom back!</h1>
}

const GuestGreeting = props => {
  return <h1>Please sign up.</h1>
}

const Greeting = props => {
  const isLoggedIn = props.isLoggedIn
  if (isLoggedIn) {
    return <UserGreeting />
  }
  return <GuestGreeting />
}

const LoginButton = props => {
  return <button onClick={props.onClick}>Login</button>
}

const LogoutButton = props => {
  return <button onClick={props.onClick}>Logout</button>
}

class LoginControl extends React.Component {
  constructor(props) {
    super(props)
    this.state = { isLoggedIn: false }

    this.handleLoginClick = this.handleLoginClick.bind(this)
    this.handleLogoutClick = this.handleLogoutClick.bind(this)
  }

  handleLoginClick() {
    this.setState({
      isLoggedIn: true
    })
  }

  handleLogoutClick() {
    this.setState({
      isLoggedIn: false
    })
  }

  render() {
    const isLoggedIn = this.state.isLoggedIn
    return (
      <div>
        <h1>Hello, Nicholas</h1>
        <Greeting isLoggedIn={isLoggedIn} />
        {isLoggedIn ? (
          <LogoutButton onClick={this.handleLogoutClick} />
        ) : (
          <LoginButton onClick={this.handleLoginClick} />
        )}
      </div>
    )
  }
}

ReactDOM.render(<LoginControl />, document.querySelector("#app"))
```

ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `if` å’Œ `ä¸‰æœ¨è¿ç®—ç¬¦` æ¥å®Œæˆæ¡ä»¶æ¸²æŸ“ï¼›

å¸¸ç”¨çš„æ¡ä»¶æ¸²æŸ“æ“ä½œï¼š

- `if` æ¡ä»¶æ¸²æŸ“

- ä¸è¿ç®—ç¬¦ `&&`

  `true && expression` æ€»æ˜¯è¿”å› `expression`

  `false && expression` æ€»æ˜¯è¿”å› `false`

- ä¸‰ç›®è¿ç®—ç¬¦ `condition ? true : false`

### # Preventing Component from Rendering

åœ¨æå°‘æ•°çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½å¸Œæœ›èƒ½éšè—ç»„ä»¶ï¼Œå³ä½¿å®ƒå·²ç»è¢«å…¶ä»–ç»„ä»¶æ¸²æŸ“äº†ã€‚è‹¥è¦å®Œæˆæ­¤æ“ä½œï¼Œä½ å¯ä»¥è®© `render` æ–¹æ³•ç›´æ¥è¿”å› `null`ï¼Œè€Œä¸è¿›è¡Œä»»ä½•æ¸²æŸ“ã€‚

```javascript
const WarningBanner = props => {
  // åœ¨ç»„ä»¶çš„ render æ–¹æ³•ä¸­è¿”å› null å¹¶ä¸å½±å“ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼ŒcomponentDidUpdate ä¾ç„¶è¢«è°ƒç”¨
  if (!props.warn) {
    return null
  }

  return <div className="warning">Warning!</div>
}

class Page extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      showWarning: true
    }

    this.handleToggleClick = this.handleToggleClick.bind(this)
  }

  handleToggleClick() {
    this.setState(state => ({
      showWarning: !state.showWarning
    }))
  }

  render() {
    return (
      <div>
        <WarningBanner warn={this.state.showWarning} />
        <button onClick={this.handleToggleClick}>{this.state.showWarning ? "Hide" : "Show"}</button>
      </div>
    )
  }
}

ReactDOM.render(<Page />, document.querySelector("#app"))
```

## # Lists and Keys

`map()` å‡½æ•°å¯ä»¥æ“ä½œæ•°ç»„çš„æ¯ä¸€é¡¹ï¼Œæ¯”å¦‚å°†æ•°ç»„çš„æ¯ä¸€é¡¹å˜åŒå€ï¼š

```javascript
const numbers = [1, 2, 3, 4, 5, 6]
const doubled = numbers.map(number => number * 2)
console.log(doubled)
```

### # æ¸²æŸ“å¤šä¸ªç»„ä»¶

```javascript
// arr.map(function(value, index, arr) { ... }) å‡½æ•°
const numbers = [1, 2, 3, 4, 5, 6]

// æ¸²æŸ“å¤šä¸ªç»„ä»¶
// Warning: Each child in a list should have a unique "key" prop.
// const listItems = numbers.map((number) => <li>{ number }</li>)

const listItems = numbers.map((number, index) => <li key={index}>{number}</li>)
ReactDOM.render(<ul>{listItems}</ul>, document.querySelector("#app"))
```

### # åŸºç¡€åˆ—è¡¨ç»„ä»¶

é€šå¸¸éœ€è¦åœ¨ä¸€ä¸ªç»„ä»¶ä¸­æ¸²æŸ“åˆ—è¡¨

```javascript
// åŸºç¡€åˆ—è¡¨ç»„ä»¶
const NumberList = props => {
  const numbers = props.numbers
  // key: å¸®åŠ© React è¯†åˆ«å“ªäº›å…ƒç´ æ”¹å˜äº†ï¼Œå› æ­¤åº”å½“ç»™æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ èµ‹äºˆä¸€ä¸ªç¡®å®šçš„æ ‡è¯†
  // **ä¸€ä¸ªå…ƒç´ çš„ key æœ€å¥½æ˜¯è¿™ä¸ªå…ƒç´ åœ¨åˆ—è¡¨ä¸­æ‹¥æœ‰çš„ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å­—ç¬¦ä¸²**ï¼Œä¸€èˆ¬ä½¿ç”¨æ•°æ®ä¸­çš„ ID ä½œä¸º key
  // é€šå¸¸æ²¡æœ‰ç¡®å®š ID çš„æ—¶å€™ï¼Œæ‰è€ƒè™‘ä½¿ç”¨å…ƒç´ çš„ç´¢å¼• index ä½œä¸º key
  const listItems = numbers.map(number => <li key={number.toString()}>{number}</li>)
  return <ul>{listItems}</ul>
}

const numbers = [1, 2, 3, 4, 5, 6]

ReactDOM.render(<NumberList numbers={numbers} />, document.querySelector("#app"))
```

> key ä¼šä¼ é€’ä¿¡æ¯ç»™ React ï¼Œä½†ä¸ä¼šä¼ é€’ç»™ä½ çš„ç»„ä»¶ã€‚

### # ç”¨ key æå–ç»„ä»¶

å…ƒç´ çš„ key åªæœ‰æ”¾åœ¨å°±è¿‘çš„æ•°ç»„ä¸Šä¸‹æ–‡ä¸­æ‰æœ‰æ„ä¹‰ã€‚

```javascript
// æå–å‡ºä¸€ä¸ª ListItem ç»„ä»¶
const ListItem = props => {
  const value = props.value
  return (
    // Wrong: There is no need to specify the key here:
    // <li key={ value.toString() }>
    //     { value }
    // </li>

    <li>{value}</li>
  )
}

// åŸºç¡€åˆ—è¡¨ç»„ä»¶
const NumberList = props => {
  const numbers = props.numbers
  // Wrong: The key should have been specified here:
  // const listItems = numbers.map((number) => <NumberList value={ number } />)

  const listItems = numbers.map(number => (
    // Correct: Key should be specified inside the array
    <NumberList key={number.toString()} value={number} />
  ))

  return <ul>{listItems}</ul>
}

const numbers = [1, 2, 3, 4, 5, 6]

ReactDOM.render(<NumberList numbers={numbers} />, document.querySelector("#app"))
```

### # key åªæ˜¯åœ¨å…„å¼ŸèŠ‚ç‚¹ä¹‹é—´å¿…é¡»å”¯ä¸€

> Keys used within arrays should be unique among their siblings. However they donâ€™t need to be globally unique.

**ğŸ˜‚ è¡¨ç¤ºè¿™ä¸ªæ²¡æ•´æ˜ç™½å•¥æ„æ€ï¼ï¼ï¼**

```javascript
const Blog = props => {
  const sidebar = (
    <ul>
      {props.posts.map(post => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )

  const content = props.posts.map(post => (
    <div key={post.id}>
      <h3>{post.title}</h3>
      <p>{post.content}</p>
    </div>
  ))

  return (
    <div>
      {sidebar}
      <hr />
      {content}
    </div>
  )
}

const posts = [
  { id: 1, title: "Hello, Nicholas", content: "Welcom to learning React!" },
  { id: 2, title: "Installation", content: "You can intall React from npm" }
]

ReactDOM.render(<Blog posts={posts} />, document.querySelector("#app"))
```

### # åœ¨ JSX ä¸­åµŒå…¥ `map()`

JSX å…è®¸åœ¨å¤§æ‹¬å·ä¸­ `åµŒå…¥ä»»ä½•è¡¨è¾¾å¼` ï¼š

```javascript
const NumberList = props => {
  const numbers = props.numbers
  return (
    <ul>
      {numbers.map(number => (
        <ListItem key={number.toString()} value={number} />
      ))}
    </ul>
  )
}
```

> é¿å…æ»¥ç”¨è¿™ç§é£æ ¼ï¼›å¦‚æœä¸€ä¸ª `map()` åµŒå¥—äº†å¤ªå¤šå±‚çº§ï¼Œé‚£å¯èƒ½å°±éœ€è¦æå–ç»„ä»¶äº†ã€‚

## # Forms

> åœ¨ React é‡Œï¼ŒHTML è¡¨å•å…ƒç´ çš„å·¥ä½œæ–¹å¼å’Œå…¶ä»–çš„ DOM å…ƒç´ æœ‰äº›ä¸åŒï¼Œè¿™æ˜¯å› ä¸ºè¡¨å•å…ƒç´ é€šå¸¸ä¼šä¿æŒä¸€äº›å†…éƒ¨çš„ stateã€‚

```html
<form>
  <label> åå­—ï¼š<input type="text" name="name" /> </label>
  <input type="submit" value="æäº¤" />
</form>
```

æ­¤è¡¨å•å…·æœ‰é»˜è®¤çš„ HTML è¡¨å•è¡Œä¸ºï¼Œå³åœ¨ç”¨æˆ·æäº¤è¡¨å•åæµè§ˆåˆ°æ–°é¡µé¢ã€‚

### # Controlled Components å—æ§ç»„ä»¶

åœ¨ HTML ä¸­ï¼Œè¡¨å•å…ƒç´ ï¼ˆ`<input>`, `<textarea />`, `<input />`ï¼‰ä¹‹ç±»çš„è¡¨å•å…ƒç´ é€šå¸¸è‡ªå·±ç»´æŠ¤ `state`ï¼Œå¹¶æ ¹æ®ç”¨æˆ·è¾“å…¥è¿›è¡Œæ›´æ–°ã€‚è€Œåœ¨ React ä¸­ï¼Œå¯å˜çŠ¶æ€ï¼ˆmutable stateï¼‰é€šå¸¸ä¿å­˜åœ¨ç»„ä»¶çš„ state å±æ€§ä¸­ï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡ä½¿ç”¨ `setState()` æ¥æ›´æ–°ã€‚

å°†ä¸¤è€…ç»“åˆèµ·æ¥ï¼Œä½¿ React çš„ state æˆä¸º â€œå”¯ä¸€æ•°æ®æºâ€ã€‚æ¸²æŸ“è¡¨å•çš„ React ç»„ä»¶è¿˜æ§åˆ¶ç€ç”¨æˆ·è¾“å…¥è¿‡ç¨‹ä¸­è¡¨å•å‘ç”Ÿçš„æ“ä½œã€‚è¢« React ä»¥è¿™ç§æ–¹å¼æ§åˆ¶å–å€¼çš„è¡¨å•è¾“å…¥å…ƒç´ å°±å«åš"å—æ§ç»„ä»¶"ã€‚

ä¸¾ä¸ªæ —å­ï¼šè®©å‰ä¸€ä¸ªç¤ºä¾‹åœ¨æäº¤æ—¶æ‰“å°å‡ºåç§° â€”â€” å°†è¡¨å•å†™ä¸ºå—æ§ç»„ä»¶

```javascript
class NameForm extends React.Component {
  constructor(props) {
    super(props)
    this.state = { value: "" }

    this.handleChange = this.handleChange.bind(this)
    this.handleSubmit = this.handleSubmit.bind(this)
  }

  // å¯¹äºå—æ§ç»„ä»¶æ¥è¯´ï¼Œæ¯ä¸ª state çªå˜éƒ½æœ‰ä¸€ä¸ªç›¸å…³çš„å¤„ç†å‡½æ•°ã€‚è¿™ä½¿å¾—ä¿®æ”¹æˆ–éªŒè¯ç”¨æˆ·è¾“å…¥å˜å¾—ç®€å•ã€‚
  handleChange(event) {
    this.setState({
      value: event.target.value
    })
  }

  handleSubmit(event) {
    event.preventDefault()
    alert("æäº¤çš„åå­—ï¼š" + this.state.value)
  }

  render() {
    // ç”±äºåœ¨è¡¨å•å…ƒç´ ä¸Šè®¾ç½®äº† `value` å±æ€§ï¼Œå› æ­¤æ˜¾ç¤ºçš„å€¼å°†å§‹ç»ˆä¸º `this.state.value`;
    // ä½¿å¾— React çš„ state æˆä¸ºå”¯ä¸€æ•°æ®æº
    return (
      <form onSubmit={this.handleSubmit}>
        <label>
          åå­—ï¼š
          <input type="text" value={this.state.value} onChange={this.handleChange} />
        </label>
        <input type="submit" value="æäº¤" />
      </form>
    )
  }
}

ReactDOM.render(<NameForm />, document.querySelector("#app"))
```

### # The textarea Tag

åœ¨ HTML ä¸­ï¼Œ`<textarea>` å…ƒç´ é€šè¿‡å…¶å­å…ƒç´ å®šä¹‰å…¶æ–‡æœ¬ï¼š

```html
<textarea>
    Hello there, this is some text in a text area
</textarea>
```

è€Œåœ¨ React ä¸­ï¼Œ`<textarea>` ä½¿ç”¨ `value` å±æ€§ä»£æ›¿ï¼›ä½¿å¾—ä½¿ç”¨ `<textarea>` çš„è¡¨å•å’Œä½¿ç”¨å•è¡Œ input çš„è¡¨å•éå¸¸ç±»ä¼¼ï¼š

```javascript
class EssayForm extends React.Component {
  constructor(props) {
    super(props)
    this.state = { value: "" }

    this.handleChange = this.handleChange.bind(this)
    this.handleSubmit = this.handleSubmit.bind(this)
  }

  handleChange(event) {
    this.setState({
      value: event.target.value
    })
  }

  handleSubmit(event) {
    event.preventDefault()
    alert("An essay war submited: " + this.state.value)
  }

  render() {
    return (
      <form onSubmit={this.handleSubmit}>
        <label>
          æ–‡ç« ï¼š
          <textarea
            placeholder="Please write an essay about your favorite DOM element."
            value={this.state.value}
            onChange={this.handleChange}
            rows="10"
            cols="60"
          />
        </label>
        <input type="submit" value="æäº¤" />
      </form>
    )
  }
}

ReactDOM.render(<EssayForm />, document.querySelector("#app"))
```

### # The select Tag

åœ¨ HTML ä¸­ï¼Œ`<select>` åˆ›å»ºä¸‹æ‹‰åˆ—è¡¨æ ‡ç­¾ï¼š

```html
<select>
  <option value="grapefruit">è‘¡è„æŸš</option>
  <option value="lime">é…¸æ©™</option>
  <option selected value="coconut">æ¤°å­</option>
  <option value="mango">èŠ’æœ</option>
</select>
```

ç”±äº `selected` å±æ€§çš„è¿œå¤ï¼Œæ¤°å­é€‰é¡¹é»˜è®¤è¢«é€‰ä¸­ã€‚ä½†æ˜¯ï¼Œåœ¨ React ä¸­å¹¶ä¸ä¼šä½¿ç”¨ `selected` å±æ€§ï¼Œè€Œæ˜¯åœ¨æ ¹ `select` æ ‡ç­¾ä¸Šä½¿ç”¨ `value` å±æ€§ã€‚åœ¨åœ¨å—æ§ç»„ä»¶ä¸­æ›´ä¾¿æ·ï¼Œå› ä¸ºåªéœ€è¦åœ¨æ ¹æ ‡ç­¾ä¸­æ›´æ–°å®ƒå³å¯ï¼š

```javascript
// React å¹¶ä¸ä¼šä½¿ç”¨ `selected` å±æ€§ï¼Œè€Œæ˜¯åœ¨æ ¹ `select` æ ‡ç­¾ä¸Šä½¿ç”¨ `value` å±æ€§
class FlavorForm extends React.Component {
  constructor(props) {
    super(props)
    this.state = { value: "coconut" }

    this.handleChange = this.handleChange.bind(this)
    this.handleSubmit = this.handleSubmit.bind(this)
  }

  handleChange(event) {
    console.log(event.target)
    this.setState({
      value: event.target.value
    })
  }

  handleSubmit() {
    event.preventDefault()
    alert("Your favorite flavor is: " + this.state.value)
  }

  render() {
    return (
      <form onSubmit={this.handleSubmit}>
        <label>
          Pick your favorite flavor:
          <select value={this.state.value} onChange={this.handleChange}>
            <option value="grapefruit">Grapefruit</option>
            <option value="lime">Lime</option>
            <option value="coconut">Coconut</option>
            <option value="mango">Mango</option>
          </select>
        </label>
        <input type="submit" value="æäº¤" />
      </form>
    )
  }
}

ReactDOM.render(<FlavorForm />, document.querySelector("#app"))
```

æ€»çš„æ¥è¯´ï¼Œä½¿å¾— `<input type="text">`ã€`<textarea>`ã€`<select>` ä¹‹ç±»çš„æ ‡ç­¾éƒ½éå¸¸ç›¸ä¼¼ â€”â€” å®ƒä»¬éƒ½æ¥å—ä¸€ä¸ª `value` å±æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥å®ç°å—æ§ç»„ä»¶ã€‚

**æ³¨æ„ï¼š**  
ä½ å¯ä»¥å°†æ•°ç»„ä¼ é€’åˆ° `value` å±æ€§ä¸­ï¼Œé…åˆ `multiple` å±æ€§ï¼Œä»¥æ”¯æŒ `select` æ ‡ç­¾ä¸­é€‰æ‹©å¤šä¸ªé€‰é¡¹ï¼š

```javascript
<select multiple={ true } value={ ['B', 'C'] }>
```

### # The file input Tag

åœ¨ HTML ä¸­ï¼Œ`<input type="file">` å…è®¸ç”¨æˆ·ä»å­˜å‚¨è®¾å¤‡ä¸­é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ï¼Œå°†å…¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæˆ–é€šè¿‡ä½¿ç”¨ JavaScript çš„ `File API` è¿›è¡Œæ§åˆ¶ï¼š

```html
<input type="file" />
```

> åœ¨ HTML æ–‡æ¡£ä¸­ ï¼Œ`<input type="file">` æ ‡ç­¾æ˜¯æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€é€‰ä¸­æ–‡ä»¶çš„ã€‚è¯¥å…ƒç´ æœ‰ä¸€ä¸ª value å±æ€§ï¼Œä¿å­˜äº†ç”¨æˆ·æŒ‡å®šçš„æ–‡ä»¶çš„åç§°ï¼Œä¸ºå®‰å…¨èµ·è§ï¼Œfile-upload å…ƒç´ çš„ value å±æ€§æ˜¯åªè¯»çš„ï¼Œä¸å…è®¸ç¨‹åºå‘˜ä¿®æ”¹å®ƒçš„å€¼ï¼Œå¹¶ä¸” HTML value å±æ€§ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚

å› ä¸ºå®ƒçš„ value åªè¯»ï¼Œæ‰€ä»¥å®ƒæ˜¯ React ä¸­çš„ä¸€ä¸ª**éå—æ§**ç»„ä»¶ã€‚

### # Handling Multiple Inputs

å½“éœ€è¦å¤„ç†å¤šä¸ª `input` å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»™æ¯ä¸ªå…ƒç´ æ·»åŠ  **`name`** å±æ€§ï¼Œå¹¶è®©å¤„ç†å‡½æ•°æ ¹æ® `event.target.name` çš„å€¼é€‰æ‹©è¦æ‰§è¡Œçš„æ“ä½œã€‚

```javascript
// Handling Multiple Inputs
// å½“éœ€è¦å¤„ç†å¤šä¸ª `input` å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»™æ¯ä¸ªå…ƒç´ æ·»åŠ  **`name`** å±æ€§ï¼Œ
// å¹¶è®©å¤„ç†å‡½æ•°æ ¹æ® `event.target.name` çš„å€¼é€‰æ‹©è¦æ‰§è¡Œçš„æ“ä½œ
class Reservation extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      isGoing: true,
      numberOfGuests: 2
    }

    this.handleInputChange = this.handleInputChange.bind(this)
  }

  handleInputChange(event) {
    const target = event.target
    const value = target.type === "checkbox" ? target.checked : target.value
    const name = target.name

    // ä½¿ç”¨ ES6 è®¡ç®—å±æ€§åç§° çš„è¯­æ³•æ›´æ–°ç»™å®šè¾“å…¥åç§°å¯¹åº”çš„ state å€¼
    this.setState({
      [name]: value
    })

    // ç­‰åŒäº
    // const partialState = {}
    // partialState[name] = value
    // this.setState(partialState)
  }

  render() {
    return (
      <form>
        <label>
          å‚ä¸ï¼š
          <input name="isGoing" type="checkbox" checked={this.state.isGoing} onChange={this.handleInputChange} />
        </label>
        <br />
        <label>
          æ¥å®¾äººæ•°ï¼š
          <input
            name="numberOfGuests"
            type="number"
            value={this.state.numberOfGuests}
            onChange={this.handleInputChange}
          />
        </label>
      </form>
    )
  }
}

ReactDOM.render(<Reservation />, document.querySelector("#app"))
```

### # Controlled Input Null Value

åœ¨ `å—æ§ç»„ä»¶` ä¸ŠæŒ‡å®š value çš„ prop ä¼šé˜»æ­¢ç”¨æˆ·æ›´æ”¹è¾“å…¥ã€‚å¦‚æœä½ æŒ‡å®šäº† `value`ï¼Œä½†è¾“å…¥ä»å¯ç¼–è¾‘ï¼Œåˆ™å¯èƒ½æ˜¯ä½ æ„å¤–åœ°å°† `value` è®¾ç½®ä¸º `undefined` æˆ– `null` ã€‚

ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†è¿™ä¸€ç‚¹ï¼šï¼ˆå¦‚æœè¾“å…¥æœ€åˆè¢«é”å®šï¼Œä½†åœ¨çŸ­æ—¶é—´å»¶è¿Ÿåå˜ä¸ºå¯ç¼–è¾‘ï¼‰

```javascript
ReactDOM.render(<input value="hi" />, mountNode)
setTimeout(() => {
  ReactDOM.render(<input value={null} />, mountNode)
}, 1000)
```

### # Alternatives to Controlled Components

æœ‰æ—¶å€™ä½¿ç”¨å—æ§ç»„ä»¶ä¼šå¾ˆéº»çƒ¦ï¼Œå› ä¸ºä½ éœ€è¦ä¸ºæ•°æ®å˜åŒ–çš„æ¯ç§æ–¹å¼éƒ½ç¼–å†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå¹¶é€šè¿‡ä¸€ä¸ª React ç»„ä»¶ä¼ é€’æ‰€æœ‰çš„è¾“å…¥ state.

**éå—æ§ç»„ä»¶**ï¼Œæ˜¯å®ç°è¾“å…¥è¡¨å•çš„å¦ä¸€ç§å½¢å¼ã€‚

### # Fully - Fledged Solutions

å¦‚æœä½ æƒ³å¯»æ‰¾åŒ…å«éªŒè¯ã€è¿½è¸ªè®¿é—®å­—æ®µä»¥åŠå¤„ç†è¡¨å•æäº¤çš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨ `Formik` æ˜¯ä¸é”™çš„é€‰æ‹© â€”â€” ä¹Ÿæ˜¯å»ºç«‹åœ¨å—æ§ç»„ä»¶å’Œç®¡ç† state çš„åŸºç¡€ä¹‹ä¸Šã€‚

Formik >>> [https://jaredpalmer.com/formik](https://jaredpalmer.com/formik)
Redux-Form >>> [https://redux-form.com/](https://redux-form.com/)

## # Lifting State Up

> Oftenï¼Œseveral components need to reflect the same changing data. We recommend lifting the shared state up to their closest common ancestor.

é€šå¸¸ï¼Œå¤šä¸ªç»„ä»¶éœ€è¦åæ˜ ç›¸åŒçš„å˜åŒ–æ•°æ®ï¼Œè¿™æ—¶æˆ‘ä»¬å»ºè®®å°†å…±äº«çŠ¶æ€æå‡åˆ°æœ€è¿‘çš„å…±åŒçˆ¶ç»„ä»¶ä¸­å»ã€‚

**éœ€æ±‚ 1ï¼š**åˆ›å»ºä¸€ä¸ªç”¨äºè®¡ç®—æ°´åœ¨ç»™å®šæ¸©åº¦ä¸‹æ˜¯å¦ä¼šæ²¸è…¾çš„æ¸©åº¦è®¡ç®—å™¨ã€‚

```javascript
// BoilingVerdidct ç»„ä»¶ï¼Œæ¥å— celius æ¸©åº¦ä½œä¸ºä¸€ä¸ª prop
const BoilingVerdict = props => {
  if (props.celsius >= 100) {
    return <p>The water would boil.</p>
  }
  return <p>The water would not boil.</p>
}

// åˆ›å»ºåä¸º Calculator ç»„ä»¶ï¼Œå®ƒæ¸²æŸ“ä¸€ä¸ªç”¨äºè¾“å…¥æ¸©åº¦çš„ <input>,
// å¹¶å°†å…¶å€¼ä¿å­˜åœ¨ this.state.temperature ä¸­
class Calculator extends React.Component {
  constructor(props) {
    super(props)
    this.state = { temperature: "" }
    this.handleChange = this.handleChange.bind(this)
  }

  handleChange(e) {
    this.setState({
      temperature: e.target.value
    })
  }

  render() {
    const temperature = this.state.temperature
    return (
      <fieldset>
        <legend>Enter temperature in Celius:</legend>
        <input type="text" value={temperature} onChange={this.handleChange} />
        <BoilingVerdict celsius={parseFloat(temperature)} />
      </fieldset>
    )
  }
}

ReactDOM.render(<Calculator />, document.querySelector("#app"))
```

**éœ€æ±‚ 2ï¼š**æ·»åŠ ç¬¬äºŒä¸ªè¾“å…¥æ¡†ï¼›åœ¨å·²æœ‰æ‘„æ°æ¸©åº¦è¾“å…¥æ¡†çš„åŸºç¡€ä¸Šï¼Œæä¾›ç¬¬äºŒä¸ªåæ°åº¦çš„è¾“å…¥æ¡†ï¼Œå¹¶ä¿æŒä¸¤ä¸ªè¾“å…¥æ¡†çš„æ•°æ®åŒæ­¥ã€‚

```javascript
// æ‘„æ°åº¦ä¸åæ°åº¦ä¹‹é—´ç›¸äº’è½¬æ¢å‡½æ•°
const toCelsius = fahrenheit => {
  return ((fahrenheit - 32) * 5) / 9
}

const toFahrenheit = celsius => {
  return (celsius * 9) / 5 + 32
}

// å½“è¾“å…¥ temperature çš„å€¼æ— æ•ˆæ—¶ï¼Œå‡½æ•°è¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œåä¹‹ï¼Œåˆ™è¿”å›ä¿ç•™ä¸‰ä½å°æ•°å¹¶å››èˆäº”å…¥åçš„è½¬æ¢ç»“æœ
const tryConvert = (temperature, convert) => {
  const input = parseFloat(temperature)
  if (Number.isNaN(input)) {
    return ""
  }
  const output = convert(input)
  const rounded = Math.round(output * 1000) / 1000
  return rounded.toString()
}

// BoilingVerdidct ç»„ä»¶ï¼Œæ¥å— celius æ¸©åº¦ä½œä¸ºä¸€ä¸ª prop
const BoilingVerdict = props => {
  if (props.celsius >= 100) {
    return <p>The water would boil.</p>
  }
  return <p>The water would not boil.</p>
}

const scaleNames = {
  c: "Celsius",
  f: "Fahrenheit"
}

// â€œçŠ¶æ€æå‡â€ï¼šåœ¨ React ä¸­ï¼Œå°†å¤šä¸ªç»„ä»¶ä¸­éœ€è¦å…±äº«çš„ state å‘ä¸Šç§»åŠ¨åˆ°å®ƒä»¬çš„æœ€è¿‘å…±åŒçˆ¶ç»„ä»¶ä¸­ï¼Œä¾¿å¯å®ç°å…±äº« state.
class TemperatureInput extends React.Component {
  constructor(props) {
    super(props)
    // this.state = { temperature: '' }
    this.handleChange = this.handleChange.bind(this)
  }

  handleChange(e) {
    // this.setState({ temperature: e.target.value })
    this.props.onTemperatureChange(e.target.value)
  }

  render() {
    const temperature = this.props.temperature
    const scale = this.props.scale
    return (
      <fieldset>
        <legend>Enter temperature in {scaleNames[scale]}</legend>
        <input type="text" value={temperature} onChange={this.handleChange} />
      </fieldset>
    )
  }
}

// åˆ›å»ºåä¸º Calculator ç»„ä»¶ï¼Œå®ƒæ¸²æŸ“ä¸€ä¸ªç”¨äºè¾“å…¥æ¸©åº¦çš„ <input>,
// å¹¶å°†å…¶å€¼ä¿å­˜åœ¨ this.state.temperature ä¸­
class Calculator extends React.Component {
  constructor(props) {
    super(props)
    this.state = { temperature: "", scale: "c" }
    this.handleCelsiusChange = this.handleCelsiusChange.bind(this)
    this.handleFahrenheitChange = this.handleFahrenheitChange.bind(this)
  }

  handleCelsiusChange(temperature) {
    this.setState({ scale: "c", temperature })
  }

  handleFahrenheitChange(temperature) {
    this.setState({ scale: "f", temperature })
  }

  render() {
    const scale = this.state.scale
    const temperature = this.state.temperature
    const celsius = scale === "f" ? tryConvert(temperature, toCelsius) : temperature
    const fahrenheit = scale === "c" ? tryConvert(temperature, toFahrenheit) : temperature
    return (
      <div>
        <TemperatureInput scale="c" temperature={celsius} onTemperatureChange={this.handleCelsiusChange} />
        <TemperatureInput scale="f" temperature={fahrenheit} onTemperatureChange={this.handleFahrenheitChange} />
        <BoilingVerdict celsius={parseFloat(celsius)} />
      </div>
    )
  }
}

ReactDOM.render(<Calculator />, document.querySelector("#app"))
```

**å°ç»“ï¼š**

åœ¨ React åº”ç”¨ä¸­ï¼Œä»»ä½•å¯å˜æ•°æ®åº”å½“åªæœ‰ä¸€ä¸ªç›¸å¯¹åº”çš„å”¯ä¸€â€œæ•°æ®æºâ€ã€‚é€šå¸¸ï¼Œstate éƒ½æ˜¯é¦–å…ˆæ·»åŠ åˆ°éœ€è¦æ¸²æŸ“æ•°æ®çš„ç»„ä»¶ä¸­å»ã€‚ç„¶åï¼Œå¦‚æœå…¶ä»–ç»„ä»¶ä¹Ÿéœ€è¦è¿™ä¸ª stateï¼Œé‚£ä¹ˆä½ å¯ä»¥å°†å®ƒæå‡è‡³è¿™äº›ç»„ä»¶çš„æœ€è¿‘å…±åŒçˆ¶ç»„ä»¶ä¸­ï¼›ä¾é  `è‡ªä¸Šè€Œä¸‹çš„æ•°æ®æµï¼ˆå•å‘æ•°æ®æµï¼‰`ã€‚

## # Composition vs Inheritance

> React has a powerful compostion model, and we recommend using compostion instead of inheritance to reuse code between components.

### # Containment åŒ…å«å…³ç³»

æœ‰äº›ç»„ä»¶æ— æ³•æå‰çŸ¥æ™“å®ƒä»¬å­ç»„ä»¶çš„å…·ä½“å†…å®¹ã€‚åœ¨ `Sidebar` å’Œ `Dialog` ç­‰å±•ç°é€šç”¨å®¹å™¨ï¼ˆboxï¼‰çš„ç»„ä»¶ä¸­ç‰¹åˆ«å®¹æ˜“é‡åˆ°è¿™ç§æƒ…å†µã€‚

è¿™äº›ç»„ä»¶ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„ **`props.children`** prop æ¥å°†å®ƒä»¬çš„å­ç»„ä»¶ä¼ é€’åˆ°æ¸²æŸ“ç»“æœä¸­ï¼š

```javascript
const FancyBorder = props => {
  // props.chilren ç‰¹æ®Šçš„ children prop å°†å­ç»„ä»¶ä¼ é€’åˆ°æ¸²æŸ“ç»“æœä¸­
  return <div className={"FancyBorder FancyBorder-" + props.color}>{props.children}</div>
}
```

è¿™ä½¿å¾—åˆ«çš„ç»„ä»¶å¯ä»¥é€šè¿‡ JSX åµŒå¥—ï¼Œå°†ä»»æ„ç»„ä»¶ä½œä¸ºå­ç»„ä»¶ä¼ é€’ç»™å®ƒä»¬ã€‚

```javascript
// FancyBorder ä¸‹çš„æ‰€æœ‰å†…å®¹é€šè¿‡ props.children ä¼ é€’åˆ° <FancyBorder> ç»„ä»¶ä¸­
const WelcomDialog = () => {
  return (
    <FancyBorder color="blue">
      <h1 className="Dialog-title">Welcome</h1>
      <p className="Dialog-message">Thank you for visiting our spacecraft!</p>
    </FancyBorder>
  )
}
```

å°‘æ•°æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦åœ¨ä¸€ä¸ªç»„ä»¶ä¸­é¢„ç•™å‡ºå‡ ä¸ªâ€œæ´â€ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ä½¿ç”¨ `children`ï¼Œè€Œæ˜¯**è‡ªè¡Œçº¦å®šï¼šå°†æ‰€éœ€å†…å®¹ä¼ å…¥ propsï¼Œå¹¶ä½¿ç”¨ç›¸åº”çš„ prop**ã€‚

```javascript
const SplitPane = props => {
  return (
    <div className="SplitPane">
      <div className="SplitPane-left">{props.left}</div>
      <div className="SplitPane-right">{props.right}</div>
    </div>
  )
}

const LeftPane = () => {
  return <div>This is LeftPane</div>
}

const RightPane = () => {
  return <div>This is RightPane</div>
}

const App = () => {
  return <SplitPane left={<LeftPane />} right={<RightPane />} />
}

ReactDOM.render(<App />, document.querySelector("#app"))
```

è¿™ä¸ªç±»ä¼¼äº Vue.js ä¸­çš„ `slot` ï¼Œä½†åœ¨ React ä¸­æ²¡æœ‰ `slot` è¿™ä¸€æ¦‚å¿µï¼Œä½†å¯ä»¥å°†ä»»ä½•ä¸œè¥¿ä½œä¸º props è¿›è¡Œä¼ é€’ã€‚

### # Specialization ç‰¹ä¾‹å…³ç³»

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæŠŠä¸€äº›ç»„ä»¶çœ‹ä½œå…¶ä»–ç»„ä»¶çš„ç‰¹æ®Šå®ä¾‹ï¼Œæ¯”å¦‚ï¼š

```javascript
// WelcomeDialog å¯ä»¥è¯´æ˜¯ Dialog çš„ç‰¹æ®Šå®ä¾‹
// åœ¨ React ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç»„åˆæ¥å®ç°è¿™ä¸€ç‚¹ã€‚â€œç‰¹æ®Šâ€ç»„ä»¶å¯ä»¥é€šè¿‡ props å®šåˆ¶å¹¶æ¸²æŸ“ â€œä¸€èˆ¬â€œ ç»„ä»¶
const FancyBorder = props => {
  return <div className={"FancyBorder FancyBorder-" + props.color}>{props.children}</div>
}

const Dialog = props => {
  return (
    <FancyBorder color="blue">
      <h1 className="Dialog-title">{props.title}</h1>
      <p className="Dialog-message">{props.message}</p>
    </FancyBorder>
  )
}

const WelcomeDialog = () => {
  return <Dialog title="Welcome" message="Thank you for visiting our spacecraft!" />
}

ReactDOM.render(<WelcomeDialog />, document.querySelector("#app"))
```

**ç»„åˆä¹ŸåŒæ ·é€‚ç”¨äºä»¥ class å½¢å¼å®šä¹‰çš„ç»„ä»¶ã€‚**

```javascript
const FancyBorder = props => {
  return <div className={"FancyBorder FancyBorder-" + props.color}>{props.children}</div>
}

const Dialog = props => {
  return (
    <FancyBorder color="blue">
      <h1 className="Dialog-title">{props.title}</h1>
      <p className="Dialog-message">{props.message}</p>
      {props.children}
    </FancyBorder>
  )
}

class SignUpDialog extends React.Component {
  constructor(props) {
    super(props)
    this.state = { login: "" }
    this.handleChange = this.handleChange.bind(this)
    this.handleSignUp = this.handleSignUp.bind(this)
  }

  handleChange(e) {
    this.setState({
      login: e.target.value
    })
  }

  handleSignUp() {
    alert(`Welcome aboard, ${this.state.login}`)
  }

  render() {
    return (
      <Dialog title="Mars Exploration Program" message="How should we refer to you?">
        <input type="text" value={this.state.login} onChange={this.handleChange} />
        <button onClick={this.handleSignUp}>Sign Me Up!</button>
      </Dialog>
    )
  }
}

ReactDOM.render(<SignUpDialog />, document.querySelector("#app"))
```

**Props å’Œ ç»„åˆä¸ºä½ æä¾›äº†æ¸…æ™°è€Œå®‰å…¨åœ°å®šåˆ¶ç»„ä»¶å¤–è§‚å’Œè¡Œä¸ºçš„çµæ´»æ–¹å¼ã€‚æ³¨æ„ï¼šç»„ä»¶å¯ä»¥æ¥å—ä»»æ„ propsï¼ŒåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹ã€React å…ƒç´ ä»¥åŠå‡½æ•°ã€‚**

